{
package anytime
}

Input <- locRange:LocatedRange (EOF / [^a-zA-Z0-9] .* EOF) {
    return locRange, nil
}

LocatedRange <- rangefn:Range {
    return LocatedRange{
        RangeFn: rangefn.(RangeFunc),
        Pos:   c.pos.offset,
        Text:  c.text,
    }, nil
}

Range <- "now"i {
    return RangeFunc(func(ref time.Time, dir Direction) Range {
        return Range{
            start: ref,
            Duration: time.Second,
        }
    }), nil
} / "last"i __ "year"i {
    return RangeFunc(func(ref time.Time, dir Direction) Range {
        return truncateYear(ref.AddDate(-1, 0, 0))
    }), nil
} / "this"i __ "year"i {
    return RangeFunc(func(ref time.Time, dir Direction) Range {
        return truncateYear(ref)
    }), nil
} / "next"i __ "year"i {
    return RangeFunc(func(ref time.Time, dir Direction) Range {
        return truncateYear(ref.AddDate(1, 0, 0))
    }), nil
} / "yesterday"i {
    return RangeFunc(func(ref time.Time, dir Direction) Range {
        return truncateDay(ref.AddDate(0, 0, -1))
    }), nil
} / "today"i {
    return RangeFunc(func(ref time.Time, dir Direction) Range {
        return truncateDay(ref)
    }), nil
} / "tomorrow"i {
    return RangeFunc(func(ref time.Time, dir Direction) Range {
        return truncateDay(ref.AddDate(0, 0, 1))
    }), nil
}

__ "nonempty whitespace" <- [ \t\r\n]+

EOF <- !.
